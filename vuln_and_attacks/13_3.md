## Домашнее задание к занятию «Защита сети»  

### Задание 1  
Проведите разведку системы и определите, какие сетевые службы запущены на защищаемой системе:  
```
sudo nmap -sA < ip-адрес >
sudo nmap -sT < ip-адрес >
sudo nmap -sS < ip-адрес >
sudo nmap -sV < ip-адрес >
```
По желанию можете поэкспериментировать с опциями: https://nmap.org/man/ru/man-briefoptions.html.  
В качестве ответа пришлите события, которые попали в логи Suricata и Fail2Ban, прокомментируйте результат.  

#### Ответ:  
Устанавливаем  
```
sudo apt-get install suricata
sudo suricata-update
sudo systemctl enable suricata
sudo systemctl start suricata.service
sudo systemctl status suricata.service
```
Настраиваем  
```
sudo nano /etc/suricata/suricata.yaml
Изменяем значение параметра EXTERNAL_NET на "any"
sudo systemctl restart suricata
Файлы логов
sudo tail /var/log/suricata/suricata.log
sudo tail /var/log/suricata/stats.log
Запускаем
sudo suricata -c /etc/suricata/suricata.yaml -s signatures.rules -i enp0s9
Выводим логи с алертами
sudo tail -f /var/log/suricata/fast.log
```
Сканируем  
```
sudo nmap -sA 192.168.6.241
sudo nmap -sT 192.168.6.241
sudo nmap -sS 192.168.6.241
sudo nmap -sV 192.168.6.241
```
Логи Suricata  
```
08/30/2023-18:12:24.696074  [**] [1:2100366:8] GPL ICMP_INFO PING *NIX [**] [Classification: Misc activity] [Priority: 3] {ICMP} 192.168.6                                   .243:8 -> 192.168.6.241:0
08/30/2023-18:12:24.696074  [**] [1:2100366:8] GPL ICMP_INFO PING *NIX [**] [Classification: Misc activity] [Priority: 3] {ICMP} 192.168.6                                   .243:8 -> 192.168.6.241:0
08/30/2023-18:13:43.450205  [**] [1:2010937:3] ET SCAN Suspicious inbound to mySQL port 3306 [**] [Classification: Potentially Bad Traffic                                   ] [Priority: 2] {TCP} 192.168.6.243:51304 -> 192.168.6.241:3306
08/30/2023-18:13:43.450205  [**] [1:2010937:3] ET SCAN Suspicious inbound to mySQL port 3306 [**] [Classification: Potentially Bad Traffic                                   ] [Priority: 2] {TCP} 192.168.6.243:51304 -> 192.168.6.241:3306
08/30/2023-18:13:43.452772  [**] [1:2010935:3] ET SCAN Suspicious inbound to MSSQL port 1433 [**] [Classification: Potentially Bad Traffic                                   ] [Priority: 2] {TCP} 192.168.6.243:43530 -> 192.168.6.241:1433
08/30/2023-18:13:43.452772  [**] [1:2010935:3] ET SCAN Suspicious inbound to MSSQL port 1433 [**] [Classification: Potentially Bad Traffic                                   ] [Priority: 2] {TCP} 192.168.6.243:43530 -> 192.168.6.241:1433
08/30/2023-18:13:43.456503  [**] [1:2002911:6] ET SCAN Potential VNC Scan 5900-5920 [**] [Classification: Attempted Information Leak] [Pri                                   ority: 2] {TCP} 192.168.6.243:48922 -> 192.168.6.241:5901
08/30/2023-18:13:43.457937  [**] [1:2010939:3] ET SCAN Suspicious inbound to PostgreSQL port 5432 [**] [Classification: Potentially Bad Tr                                   affic] [Priority: 2] {TCP} 192.168.6.243:37462 -> 192.168.6.241:5432
08/30/2023-18:13:43.459153  [**] [1:2002910:6] ET SCAN Potential VNC Scan 5800-5820 [**] [Classification: Attempted Information Leak] [Pri                                   ority: 2] {TCP} 192.168.6.243:52942 -> 192.168.6.241:5801
08/30/2023-18:13:43.465361  [**] [1:2010936:3] ET SCAN Suspicious inbound to Oracle SQL port 1521 [**] [Classification: Potentially Bad Tr                                   affic] [Priority: 2] {TCP} 192.168.6.243:53844 -> 192.168.6.241:1521
08/30/2023-18:13:43.456503  [**] [1:2002911:6] ET SCAN Potential VNC Scan 5900-5920 [**] [Classification: Attempted Information Leak] [Pri                                   ority: 2] {TCP} 192.168.6.243:48922 -> 192.168.6.241:5901
08/30/2023-18:13:43.457937  [**] [1:2010939:3] ET SCAN Suspicious inbound to PostgreSQL port 5432 [**] [Classification: Potentially Bad Tr                                   affic] [Priority: 2] {TCP} 192.168.6.243:37462 -> 192.168.6.241:5432
08/30/2023-18:13:43.459518  [**] [1:2002910:6] ET SCAN Potential VNC Scan 5800-5820 [**] [Classification: Attempted Information Leak] [Pri                                   ority: 2] {TCP} 192.168.6.243:60772 -> 192.168.6.241:5800
08/30/2023-18:13:43.465361  [**] [1:2010936:3] ET SCAN Suspicious inbound to Oracle SQL port 1521 [**] [Classification: Potentially Bad Tr                                   affic] [Priority: 2] {TCP} 192.168.6.243:53844 -> 192.168.6.241:1521
08/30/2023-18:14:08.315206  [**] [1:2010937:3] ET SCAN Suspicious inbound to mySQL port 3306 [**] [Classification: Potentially Bad Traffic                                   ] [Priority: 2] {TCP} 192.168.6.243:61616 -> 192.168.6.241:3306
08/30/2023-18:14:08.315206  [**] [1:2010937:3] ET SCAN Suspicious inbound to mySQL port 3306 [**] [Classification: Potentially Bad Traffic                                   ] [Priority: 2] {TCP} 192.168.6.243:61616 -> 192.168.6.241:3306
08/30/2023-18:14:08.318053  [**] [1:2010939:3] ET SCAN Suspicious inbound to PostgreSQL port 5432 [**] [Classification: Potentially Bad Tr                                   affic] [Priority: 2] {TCP} 192.168.6.243:61616 -> 192.168.6.241:5432
08/30/2023-18:14:08.318053  [**] [1:2010939:3] ET SCAN Suspicious inbound to PostgreSQL port 5432 [**] [Classification: Potentially Bad Tr                                   affic] [Priority: 2] {TCP} 192.168.6.243:61616 -> 192.168.6.241:5432
08/30/2023-18:14:08.326323  [**] [1:2010935:3] ET SCAN Suspicious inbound to MSSQL port 1433 [**] [Classification: Potentially Bad Traffic                                   ] [Priority: 2] {TCP} 192.168.6.243:61616 -> 192.168.6.241:1433
08/30/2023-18:14:08.326323  [**] [1:2010935:3] ET SCAN Suspicious inbound to MSSQL port 1433 [**] [Classification: Potentially Bad Traffic                                   ] [Priority: 2] {TCP} 192.168.6.243:61616 -> 192.168.6.241:1433
08/30/2023-18:14:08.330004  [**] [1:2010936:3] ET SCAN Suspicious inbound to Oracle SQL port 1521 [**] [Classification: Potentially Bad Tr                                   affic] [Priority: 2] {TCP} 192.168.6.243:61616 -> 192.168.6.241:1521
08/30/2023-18:14:08.330004  [**] [1:2010936:3] ET SCAN Suspicious inbound to Oracle SQL port 1521 [**] [Classification: Potentially Bad Tr                                   affic] [Priority: 2] {TCP} 192.168.6.243:61616 -> 192.168.6.241:1521
08/30/2023-18:14:25.959524  [**] [1:2010937:3] ET SCAN Suspicious inbound to mySQL port 3306 [**] [Classification: Potentially Bad Traffic                                   ] [Priority: 2] {TCP} 192.168.6.243:38779 -> 192.168.6.241:3306
08/30/2023-18:14:25.959524  [**] [1:2010937:3] ET SCAN Suspicious inbound to mySQL port 3306 [**] [Classification: Potentially Bad Traffic                                   ] [Priority: 2] {TCP} 192.168.6.243:38779 -> 192.168.6.241:3306
08/30/2023-18:14:25.962738  [**] [1:2010939:3] ET SCAN Suspicious inbound to PostgreSQL port 5432 [**] [Classification: Potentially Bad Tr                                   affic] [Priority: 2] {TCP} 192.168.6.243:38779 -> 192.168.6.241:5432
08/30/2023-18:14:25.962738  [**] [1:2010939:3] ET SCAN Suspicious inbound to PostgreSQL port 5432 [**] [Classification: Potentially Bad Tr                                   affic] [Priority: 2] {TCP} 192.168.6.243:38779 -> 192.168.6.241:5432
08/30/2023-18:14:25.966934  [**] [1:2010935:3] ET SCAN Suspicious inbound to MSSQL port 1433 [**] [Classification: Potentially Bad Traffic                                   ] [Priority: 2] {TCP} 192.168.6.243:38779 -> 192.168.6.241:1433
08/30/2023-18:14:25.966934  [**] [1:2010935:3] ET SCAN Suspicious inbound to MSSQL port 1433 [**] [Classification: Potentially Bad Traffic                                   ] [Priority: 2] {TCP} 192.168.6.243:38779 -> 192.168.6.241:1433
08/30/2023-18:14:25.972128  [**] [1:2010936:3] ET SCAN Suspicious inbound to Oracle SQL port 1521 [**] [Classification: Potentially Bad Tr                                   affic] [Priority: 2] {TCP} 192.168.6.243:38779 -> 192.168.6.241:1521
08/30/2023-18:14:25.972128  [**] [1:2010936:3] ET SCAN Suspicious inbound to Oracle SQL port 1521 [**] [Classification: Potentially Bad Tr                                   affic] [Priority: 2] {TCP} 192.168.6.243:38779 -> 192.168.6.241:1521
```
Пинг получил приоритет 3  
nmap -sA, nmap -sS, nmap -sT, nmap -sV получили приоритет 2, как потенциально опасный  
nmap -sV мог получить приоритет 1, если был бы распознан как веб-атака  
fail2ban на сканирования не отреагировал  


### Задание 2  
Проведите атаку на подбор пароля для службы SSH:  
```
hydra -L users.txt -P pass.txt < ip-адрес > ssh
```
Настройка hydra:  
создайте два файла: users.txt и pass.txt;  
в каждой строчке первого файла должны быть имена пользователей, второго — пароли. В нашем случае это могут быть случайные строки, но ради эксперимента можете добавить имя и пароль существующего пользователя.  
Дополнительная информация по hydra: https://kali.tools/?p=1847.  

Включение защиты SSH для Fail2Ban:  
открыть файл /etc/fail2ban/jail.conf,  
найти секцию ssh,  
установить enabled в true.  
Дополнительная информация по Fail2Ban:https://putty.org.ru/articles/fail2ban-ssh.html.  

В качестве ответа пришлите события, которые попали в логи Suricata и Fail2Ban, прокомментируйте результат.  

#### Ответ:  

